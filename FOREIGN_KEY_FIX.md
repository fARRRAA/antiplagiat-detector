# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –æ—à–∏–±–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ (FOREIGN KEY)

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:**
```
SqlException: The INSERT statement conflicted with the FOREIGN KEY constraint "FK_dbo.Documents_dbo.Projects_ProjectId". 
The conflict occurred in database "PlagiatAssistant", table "dbo.Projects", column 'Id'.
```

**–ü—Ä–∏—á–∏–Ω–∞:** –î–æ–∫—É–º–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `LoadTestDocument`**
```csharp
// –ë–´–õ–û: –ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è, –Ω–æ ID –Ω–µ –ø–æ–ª—É—á–∞–ª—Å—è
await _dataService.SaveProjectAsync(_currentProject);

// –°–¢–ê–õ–û: –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–µ–∫—Ç —Å ID –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
_currentProject = await _dataService.SaveProjectAsync(_currentProject);
```

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `ImportDocument`**
```csharp
// –î–û–ë–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞
if (_currentProject.Id == 0)
{
    _currentProject = await _dataService.SaveProjectAsync(_currentProject);
}

document.ProjectId = _currentProject.Id;
document = await _dataService.SaveDocumentAsync(document);
```

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞**
```csharp
// –î–û–ë–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ ID –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞
if (_currentProject.Id == 0)
{
    _currentProject = await _dataService.SaveProjectAsync(_currentProject);
}

testDocument.ProjectId = _currentProject.Id;
testDocument = await _dataService.SaveDocumentAsync(testDocument);
```

### 4. **–£–ª—É—á—à–µ–Ω `DataService.SaveDocumentAsync`**
```csharp
// –î–û–ë–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
if (document.ProjectId.HasValue && document.ProjectId.Value > 0)
{
    var projectExists = await _context.Projects.AnyAsync(p => p.Id == document.ProjectId.Value);
    if (!projectExists)
    {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç, –µ—Å–ª–∏ –æ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        var newProject = new Project
        {
            Name = "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç",
            CreatedAt = DateTime.Now,
            Status = ProjectStatus.Active
        };
        _context.Projects.Add(newProject);
        await _context.SaveChangesAsync();
        
        document.ProjectId = newProject.Id;
    }
}
```

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

### ‚úÖ **–¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
1. **–í—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–µ–∫—Ç** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞
2. **–ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID** –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
3. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞** –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç** –µ—Å–ª–∏ –æ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
5. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞**

## üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:**

### **–®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
- –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### **–®–∞–≥ 2: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–º–ø–æ—Ä—Ç**
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ `simple_test.txt`
- –î–æ–∫—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
- –ü—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º ID
- –î–æ–∫—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç

## üîç **–û–¢–õ–ê–î–ö–ê:**

### **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—Å—ë –µ—â—ë –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** - –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç—Å—è

### **–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
SELECT * FROM Projects;

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∏—Ö ProjectId
SELECT Id, Title, ProjectId FROM Documents;
```

## üöÄ **–ü–†–ò–õ–û–ñ–ï–ù–ò–ï –ì–û–¢–û–í–û!**

–û—à–∏–±–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞ –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–Ω–∏–∫–∞—Ç—å. –î–æ–∫—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–≤—è–∑—ã–≤–∞—Ç—å—Å—è —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏.

